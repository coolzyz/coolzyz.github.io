<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>Redis 配置不当导致root权限泄露 | Freedome</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/very-simple.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"></head><body><!-- include the sidebar--><!-- include ./includes/sidebar.jade--><!-- Blog title and subtitle--><header><div class="container header"><a id="logo" href="/." class="title">Freedome</a><span class="subtitle"></span><label id="toggle-menu" for="menu" onclick><i class="fa fa-bars"></i></label></div></header><!-- use checkbox hack for toggle nav-bar on small screens--><input id="menu" type="checkbox"><!-- Navigation Links--><nav id="nav"><div class="container"><a href="/" class="sidebar-nav-item active">Home</a><a href="/archives" class="sidebar-nav-item">Archives</a></div></nav><div id="header-margin-bar"></div><!-- gallery that comes before the header--><div class="wrapper"><div class="container post-header"><h1>Redis 配置不当导致root权限泄露</h1></div></div><div class="wrapper"><div class="container meta"><div class="post-time">2016-05-27</div><div class="post-tags"><a class="post-tag-link" href="/tags/redis/">redis</a>/<a class="post-tag-link" href="/tags/ssh/">ssh</a>/<a class="post-tag-link" href="/tags/权限/">权限</a></div></div></div><article><div class="container post"><p>Redis默认无需认证既可以被外部访问，黑客连接redis服务后可以向指定文件夹写入内容。</p>
<p>此时如果redis服务是root权限启动的话，黑客可以直接将公钥写入authorize_keys文件，实现ssh无密码登陆</p>
<a id="more"></a>
<p>前几日公司安全提醒外网有两台主机的流量异常，定位到是Redis配置不当导致利用ssh服务获得root访问权限。</p>
<h2 id="出现这个问题有如下几个条件："><a href="#出现这个问题有如下几个条件：" class="headerlink" title="出现这个问题有如下几个条件："></a>出现这个问题有如下几个条件：</h2><ul>
<li>外网可访问redis</li>
<li>redis服务以root权限运行</li>
</ul>
<h2 id="修复方案"><a href="#修复方案" class="headerlink" title="修复方案"></a>修复方案</h2><p>触发的必要条件知道后只需对症下药即可</p>
<ul>
<li>限制可以访问redis数据库的ip</li>
</ul>
<blockquote>
<p>编辑redis.conf, 加入 <code>bind 127.0.0.1</code> 限制本机访问</p>
</blockquote>
<ul>
<li>设置访问redis的密码</li>
</ul>
<blockquote>
<p>编辑redis.conf，加入<code>requirepass mypassword</code>  </p>
</blockquote>
<ul>
<li>不以root权限启动Redis</li>
</ul>
<blockquote>
<p>建议使用没有登录权限的用户(nobody)启动Redis服务</p>
</blockquote>
<p>以上配置需要重启Redis后生效</p>
<p>由于Redis加入了密码验证，相应的服务器需要在连接redis的时候进行验证, 在句柄连接初始化后，通过执行命令<code>auth mypassword</code>完成验证，验证通过以后即可正常使用句柄访问redis服务</p>
</div><!-- comment system--><div class="container"><hr></div></article><footer id="footer"><div class="container"><div class="bar"><div class="social"><a href="/atom.xml" target="_blank"><i class="fa fa-rss"></i></a></div><div class="footer">© 2018 <a href="/" rel="nofollow">coolzyz</a>. Powered by <a rel="nofollow" target="_blank" href="https://hexo.io">Hexo</a>. Theme <a target="_blank" href="https://github.com/lotabout/very-simple">very-simple</a>.</div></div></div></footer><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
    $(".fancybox").fancybox();
});
</script></body></html>